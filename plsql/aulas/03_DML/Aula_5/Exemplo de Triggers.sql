
CREATE TABLE TAB_FATURAMENTO
(DATA_VENDA DATE NULL, TOTAL_VENDA FLOAT);

SELECT * FROM CLIENTES;
SELECT * FROM VENDEDORES;
SELECT * FROM PRODUTOS;

DELETE FROM ITEMS_NOTAS;
DELETE FROM NOTAS;

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES
('0100', TO_DATE('2019-06-05','YYYY-MM-DD'), '1471156710', '235', 0.10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0100', '1040107', 1000, 10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0100', '1000889', 1000, 10);

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES
('0101', TO_DATE('2019-06-05','YYYY-MM-DD'), '3623344710', '235', 0.10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0101', '1040107', 1000, 10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0101', '1000889', 1000, 10);

SELECT * FROM NOTAS;
SELECT * FROM ITEMS_NOTAS;

SELECT NOTAS.DATA_VENDA, SUM(ITEMS_NOTAS.QUANTIDADE * ITEMS_NOTAS.PRECO) AS TOTAL_VENDA
FROM NOTAS INNER JOIN ITEMS_NOTAS
ON NOTAS.NUMERO = ITEMS_NOTAS.NUMERO
GROUP BY NOTAS.DATA_VENDA;

INSERT INTO TAB_FATURAMENTO
SELECT NOTAS.DATA_VENDA, SUM(ITEMS_NOTAS.QUANTIDADE * ITEMS_NOTAS.PRECO) AS TOTAL_VENDA
FROM NOTAS INNER JOIN ITEMS_NOTAS
ON NOTAS.NUMERO = ITEMS_NOTAS.NUMERO
GROUP BY NOTAS.DATA_VENDA;

SELECT * FROM TAB_FATURAMENTO;

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES
('0102', TO_DATE('2019-06-05','YYYY-MM-DD'), '3623344710', '235', 0.10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0102', '1040107', 1000, 10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0102', '1000889', 1000, 10);

DELETE FROM TAB_FATURAMENTO;

INSERT INTO TAB_FATURAMENTO
SELECT NOTAS.DATA_VENDA, SUM(ITEMS_NOTAS.QUANTIDADE * ITEMS_NOTAS.PRECO) AS TOTAL_VENDA
FROM NOTAS INNER JOIN ITEMS_NOTAS
ON NOTAS.NUMERO = ITEMS_NOTAS.NUMERO
GROUP BY NOTAS.DATA_VENDA;

CREATE TRIGGER TG_CALCULO_FATURAMENTO
AFTER INSERT ON ITEMS_NOTAS
BEGIN
DELETE FROM TAB_FATURAMENTO;
INSERT INTO TAB_FATURAMENTO
SELECT NOTAS.DATA_VENDA, SUM(ITEMS_NOTAS.QUANTIDADE * ITEMS_NOTAS.PRECO) AS TOTAL_VENDA
FROM NOTAS INNER JOIN ITEMS_NOTAS
ON NOTAS.NUMERO = ITEMS_NOTAS.NUMERO
GROUP BY NOTAS.DATA_VENDA;
END;

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES
('0103', TO_DATE('2019-06-05','YYYY-MM-DD'), '3623344710', '235', 0.10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0103', '1040107', 1000, 10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0103', '1000889', 1000, 10);

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES
('0104', TO_DATE('2019-06-06','YYYY-MM-DD'), '3623344710', '235', 0.10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0104', '1040107', 1000, 10);
INSERT INTO ITEMS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES
('0104', '1000889', 1000, 10);








